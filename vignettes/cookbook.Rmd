---
title: Running the analysis
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Running the analysis}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Config

All of the functions needed to run a PACTA for Supervisors analysis take a `config` argument, which can either be a path to a `config.yml` file (see `vignette("config_yml")`) or a config list object containing previously imported settings from a `config.yml` file. All of the settings/options are configured with this `config.yml` file.

# Setup

You'll likely want to load the package and save the path to the `config.yml` file in a variable first:

```r
library(pacta.multi.loanbook)
config_path <- "config.yml"
```

# Data preparation

The first step of the analysis is to prepare your input data sets for the requirements of the analysis. Your ABCD data will need to be prepared and you can optionally use a custom sector split, that will also need to be prepared. The relevant function is `prepare_abcd()`, which takes configurations from the `config.yml` that you have prepared. The function will store intermediary files in a sub-directory in your `output` folder. You can run this function as follows:

```r
pacta.multi.loanbook::prepare_abcd(config_path)
```

# Matching process

To run the matching process, you will use the `match_loanbooks()` function. This will read the raw loan books from yout inputs and attempt to match them to the prepared ABCD data from the previous step. The function will store matched loan book files in a sub-directory in your `output` folder. You can run this function as follows:

```r
pacta.multi.loanbook::match_loanbooks(config_path)
```

After the matching process is complete, you will need to do some manual matching.

# Prioritization of loan books; Match success and coverage diagnostics

The next step is to prioritize the manually verified matched loan books and analyze their coverage, both relative to the raw loan book inputs and to the production capacity in the wider economy. Prioritizing the loan books means that you will only keep the best identified match for each loan and use that in the following steps of the analysis. You will probably want to check the status of your loan book and production coverage several times, as it is rare to get to the desired level of matching in one iteration. This means you may want to repeat the previous step and this step a number of times to reach the best possible outcome. To prioritize your matched loan books and calculate display the coverage diagnostics, you will use the `prioritise_and_diagnose()` function. This call will store matched prioritized loan book files and coverage diagnostics in a sub-directory in your `output` folder.

```r
pacta.multi.loanbook::prioritise_and_diagnose(config_path)
```

# Run PACTA for Supervisors analysis

The final step is running the analysis based on the parameters you have set in the `config.yml` file. This entails both a standard PACTA for Banks analysis and the calculation of the net aggregate alignment metric. For both parts of the analysis, outputs will be stored in a sub-directory in your `output` folder and comprise tabular outputs and plots.
To run the analysis on all of your previously matched and prioritized loan books, you will use the `analyse()` function.

```r
pacta.multi.loanbook::analyse(config_path)
```
