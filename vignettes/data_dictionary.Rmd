---
title: data dictionary
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{data_dictionary}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(workflow.multi.loanbook)
```
# Intro

In many cases, users of this package will want to use the outputs of the analyses for further processing, such as additional analyses or making visualizations based on the design guide of their own organisation. To facilitate such additional use cases, but also simplify interpretation of the outputs generated with this package, this data dictionary documents each type of output table in detail, focusing on data types and definitions.

This article is structured based on the output tables generated by `workflow.multi.loanbook` and follows the standard flow of the user experience as much as possible, so it can be read in the same sequence as the analysis is run.

# Tables

The main steps that generate output tables are:

* Diagnostics and coverage
* Standard PACTA analysis
* Aggregated PACTA metrics

## Diagnostics

The diagnostics section is split into determining the match success rate of the loan books analysed and inspecting the real economy activity related to the financing made by the banks through the matched loan books. The former is influenced by the quality of the input loan book data and the completeness of the reference production data against which the loan books are matched. The latter, while it depends on a solid match success rate, is mainly driven by the financing decisions and the portfolio allocation made by the banks.

### Match success rate

```{r dd_lbk_match_success_rate}
dd_lbk_match_success_rate <- dplyr::filter(data_dictionary, .data[["dataset"]] == "lbk_match_success_rate")
DT::datatable(dd_lbk_match_success_rate)

```

### Loan book coverage

```{r dd_summary_statistics_loanbook_coverage}
dd_summary_statistics_loanbook_coverage <- dplyr::filter(data_dictionary, .data[["dataset"]] == "summary_statistics_loanbook_coverage")
DT::datatable(dd_summary_statistics_loanbook_coverage)

```

## Standard PACTA analysis

The standard PACTA analysis is run across all input banking books, but produces the same output metrics as known from the `r2dii.*` packages. Results are given at portfolio level grouped by banking book. Beyond the standard output format, tables are provided that can be used as input for visualizations, for each of the standard sectors and technologies.

### Target Market Share results (all groups)

Target market share results at the portfolio level for each included banking book

```{r dd_tms_results_all_groups}
dd_tms_results_all_groups <- dplyr::filter(data_dictionary, .data[["dataset"]] == "tms_results_all_groups")
DT::datatable(dd_tms_results_all_groups)

```


### Sectoral Decarbonization Approach results (all groups)

SDA results at the portfolio level for each included banking book

```{r dd_sda_results_all_groups}
dd_sda_results_all_groups <- dplyr::filter(data_dictionary, .data[["dataset"]] == "sda_results_all_groups")
DT::datatable(dd_sda_results_all_groups)

```


### Data tech mix

Results for a given portfolio and sector, tailored to be used in the tech mix chart

```{r dd_data_tech_mix}
dd_data_tech_mix <- dplyr::filter(data_dictionary, .data[["dataset"]] == "data_tech_mix")
DT::datatable(dd_data_tech_mix)

```


### Data trajectory

Results for a given portfolio, sector and technology, tailored to be used in the volume trajectory chart

```{r dd_data_trajectory}
dd_data_trajectory <- dplyr::filter(data_dictionary, .data[["dataset"]] == "data_trajectory")
DT::datatable(dd_data_trajectory)

```


### Data emission intensity

Results for a given portfolio and sector, tailored to be used in the emission intensity chart

```{r dd_data_emission_intensity}
dd_data_emission_intensity <- dplyr::filter(data_dictionary, .data[["dataset"]] == "data_trajectory")
DT::datatable(dd_data_emission_intensity)

```


### Companies included

Lists all companies including exposures, that were analysed for the given loan book and that are therefore included in the data to be visualized.

```{r dd_companies_included}
dd_companies_included <- dplyr::filter(data_dictionary, .data[["dataset"]] == "companies_included")
DT::datatable(dd_companies_included)

```


## Aggregated PACTA metrics

dd_company_technology_deviation_tms,
  dd_company_alignment_net_tms,
  dd_company_alignment_bo_po_tms,
  dd_company_alignment_net_sda,
  dd_company_exposure_bo_po_aggregate_alignment,
  dd_company_exposure_net_aggregate_alignment,
  dd_loanbook_exposure_bo_po_aggregate_alignment,
  dd_loanbook_exposure_net_aggregate_alignment,
  dd_data_sankey,
  dd_data_scatter_alignment_exposure,
  dd_data_scatter_sector,
  dd_data_scatter_sector_animated,
  dd_data_timeline_net,
  dd_data_timeline_bo_po
